<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Silas</title>
    <meta name="theme-color" content="#0a0f1e" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="manifest" href="/manifest.json" />
    <link rel="icon" href="/icons/icon-192.png" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />
    <link rel="stylesheet" href="/style.css" />
    <style>
      /* Keep onboarding isolated and centered above the app shell while preserving
         the existing glass visual language used by other overlay surfaces. */
      .onboarding-overlay {
        position: fixed;
        inset: 0;
        z-index: 120;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: clamp(1rem, 4vw, 2rem);
        opacity: 0;
        pointer-events: none;
        transition: opacity var(--dur-fast, 0.2s) var(--ease-out, ease);
      }

      .onboarding-overlay.is-visible {
        opacity: 1;
        pointer-events: auto;
      }

      .onboarding-backdrop {
        position: absolute;
        inset: 0;
        background: rgba(5, 10, 18, 0.55);
      }

      .onboarding-card {
        position: relative;
        z-index: 1;
        width: min(560px, 100%);
        max-height: calc(100dvh - 2rem);
        overflow-y: auto;
        padding: clamp(1rem, 3vw, 1.5rem);
      }

      .glass-overlay {
        background: rgba(18, 28, 47, 0.62);
        border: 1px solid rgba(255, 255, 255, 0.22);
        backdrop-filter: blur(22px);
        -webkit-backdrop-filter: blur(22px);
      }
    </style>
  </head>
  <body class="h-full overflow-hidden">
    <a href="#stream" class="skip-link">Skip to content</a>

    <div id="app-shell" class="app-shell">
      <div id="app-main" class="flex-1 min-w-0 flex flex-col overflow-hidden">
        <!-- Status Strip -->
        <header class="shrink-0 px-4 pt-[env(safe-area-inset-top)]">
          <div class="mx-auto max-w-[760px] h-11 flex items-center justify-between gap-3">
            <button
              id="status-strip"
              type="button"
              class="status-strip hidden"
              aria-controls="work-panel"
              aria-expanded="false"
              aria-label="Open active work panel"
            >
              <span id="work-status" class="status-strip-label"></span>
            </button>

            <div class="flex items-center gap-3 shrink-0">
              <button
                id="side-panel-toggle"
                type="button"
                class="side-panel-toggle hidden md:inline-flex items-center justify-center w-11 h-11 rounded-full text-text-secondary hover:text-text-primary transition-colors duration-100"
                aria-label="Toggle side panel"
                aria-controls="side-panel"
                aria-expanded="false"
              >
                <svg
                  width="18"
                  height="18"
                  viewBox="0 0 18 18"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="1.5"
                  stroke-linecap="round"
                >
                  <path d="M3.5 5h11M3.5 9h11M3.5 13h11" />
                </svg>
              </button>
              <span
                id="status-dot"
                class="status-dot w-2 h-2 rounded-full bg-status-amber transition-colors duration-200"
                role="status"
                aria-label="Connecting"
              ></span>
              <button
                id="install-btn"
                class="text-xs text-tint hover:text-tint-hover transition-colors duration-100 hidden"
                aria-label="Install app"
              >
                Install
              </button>
            </div>
          </div>
          <div class="mx-auto max-w-[760px]">
            <div
              id="session-tab-bar"
              class="glass flex items-center justify-between gap-3 px-4 py-1"
              role="navigation"
              aria-label="Session tabs"
            >
              <div id="session-tabs" class="flex items-center gap-3 min-w-0" role="tablist" aria-label="Sessions"></div>
              <button
                id="new-side-session-btn"
                type="button"
                class="card-cta-primary shrink-0"
                aria-label="Create side session"
              >
                New Side
              </button>
            </div>
            <div
              id="notification-prompt"
              class="glass px-4 py-3 hidden"
              role="status"
              aria-live="polite"
              style="margin-top: 8px;"
            >
              <p id="notification-prompt-text" class="text-xs text-text-secondary">
                Enable notifications for approval requests while the app is backgrounded.
              </p>
              <div class="glass-card-actions">
                <button id="notification-enable-btn" type="button" class="card-cta-primary">Enable</button>
                <button id="notification-dismiss-btn" type="button" class="card-cta-secondary">Not now</button>
              </div>
            </div>
          </div>
        </header>

        <!-- Stream -->
        <main id="stream" tabindex="-1" class="flex-1 overflow-y-auto px-4 pb-2">
          <div id="messages" class="mx-auto max-w-[760px] flex flex-col gap-4 min-h-full py-6">
            <!-- Empty State -->
            <div id="empty-state" class="flex-1 flex flex-col items-center justify-center select-none">
              <span class="text-5xl breathe mb-6">ðŸª¶</span>
              <p class="text-xl font-light text-text-tertiary">What should I work on?</p>
            </div>
            <div id="message-rail" class="flex flex-col gap-4"></div>
            <div id="card-container" class="flex flex-col gap-4"></div>

            <template id="approval-card-template">
              <article class="glass-card" data-card-kind="approval">
                <div class="glass-card-header">
                  <h3 class="glass-card-title" data-approval-title></h3>
                  <span class="glass-card-risk" data-approval-risk aria-hidden="true"></span>
                </div>
                <p class="glass-card-rationale" data-approval-desc></p>
                <p class="glass-card-rationale" data-approval-requester></p>
                <div class="glass-card-actions">
                  <button type="button" class="card-cta-primary" data-approval-action="approve">Approve</button>
                  <button type="button" class="card-cta-secondary" data-approval-action="deny">Deny</button>
                  <button type="button" class="card-cta-secondary" data-approval-action="defer">Defer</button>
                </div>
              </article>
            </template>

            <template id="batch-review-card-template">
              <article class="glass-card" data-card-kind="batch">
                <div class="glass-card-header">
                  <h3 class="glass-card-title" data-batch-title>Batch review</h3>
                  <p class="glass-card-rationale" data-batch-count></p>
                </div>
                <div data-batch-items class="glass-card-rationale"></div>
                <div class="glass-card-actions">
                  <button type="button" class="card-cta-secondary" data-batch-action="select_all">Select all</button>
                  <button type="button" class="card-cta-secondary" data-batch-action="deselect_all">Deselect all</button>
                  <button type="button" class="card-cta-primary" data-batch-action="approve">Batch approve</button>
                  <button type="button" class="card-cta-secondary" data-batch-action="deny">Batch deny</button>
                </div>
              </article>
            </template>

            <template id="suggestion-card-template">
              <article class="glass-card" data-card-kind="suggestion">
                <div class="glass-card-header">
                  <h3 class="glass-card-title">Suggestion</h3>
                  <p class="glass-card-rationale" data-suggestion-confidence></p>
                </div>
                <p class="glass-card-rationale" data-suggestion-text></p>
                <div class="glass-card-actions">
                  <button type="button" class="card-cta-primary" data-suggestion-action="accept">Accept</button>
                  <button type="button" class="card-cta-secondary" data-suggestion-action="dismiss">Dismiss</button>
                  <button type="button" class="card-cta-secondary" data-suggestion-action="modify">Modify</button>
                </div>
              </article>
            </template>
          </div>
        </main>

        <!-- Composer -->
        <footer class="shrink-0 px-4 pb-[env(safe-area-inset-bottom)] pb-3">
          <form id="composer" class="mx-auto max-w-[760px] relative" aria-label="Message composer">
            <div id="slash-palette" class="slash-palette glass" hidden>
              <ul id="slash-list" class="slash-list" role="listbox" aria-label="Slash commands"></ul>
            </div>
            <textarea
              id="message-input"
              rows="1"
              placeholder="Message Silasâ€¦"
              class="w-full resize-none bg-transparent text-[15px] text-text-primary placeholder:text-text-tertiary
                     py-3 pl-4 pr-12
                     border border-surface-border/0 rounded-[14px]
                     focus:border-surface-border focus:outline-none
                     transition-[border-color] duration-200
                     leading-[22px] max-h-[132px] overflow-y-auto"
              autocomplete="off"
              aria-label="Message input"
            ></textarea>
            <button
              type="submit"
              id="send-btn"
              class="absolute right-3 bottom-3 w-8 h-8 flex items-center justify-center
                     rounded-full bg-tint-subtle text-tint
                     hover:bg-tint hover:text-bg
                     transition-all duration-100
                     opacity-0 pointer-events-none"
              aria-label="Send message"
            >
              <svg
                width="16"
                height="16"
                viewBox="0 0 16 16"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M3 8h10M9 4l4 4-4 4" />
              </svg>
            </button>
          </form>
        </footer>
      </div>

      <aside id="side-panel" class="side-panel glass" aria-hidden="true">
        <div class="side-panel-header">
          <h2 class="side-panel-title">Workspace</h2>
          <button id="side-panel-close" type="button" class="side-panel-close" aria-label="Close side panel">
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            >
              <path d="M3.5 3.5l9 9M12.5 3.5l-9 9" />
            </svg>
          </button>
        </div>

        <div class="side-panel-tabs" role="tablist" aria-label="Side panel sections">
          <button
            id="tab-memory"
            type="button"
            class="side-tab is-active"
            role="tab"
            aria-selected="true"
            aria-controls="panel-memory"
            data-side-tab="memory"
          >
            Memory
          </button>
          <button
            id="tab-work"
            type="button"
            class="side-tab"
            role="tab"
            aria-selected="false"
            aria-controls="panel-work"
            data-side-tab="work"
          >
            Active Work
          </button>
          <button
            id="tab-session"
            type="button"
            class="side-tab"
            role="tab"
            aria-selected="false"
            aria-controls="panel-session"
            data-side-tab="session"
          >
            Session Info
          </button>
        </div>

        <section id="panel-memory" class="side-panel-section" role="tabpanel" aria-labelledby="tab-memory">
          <p class="side-panel-empty">No memory snippets yet.</p>
        </section>
        <section
          id="panel-work"
          class="side-panel-section"
          role="tabpanel"
          aria-labelledby="tab-work"
          hidden
        >
          <div id="side-work-items" class="side-work-items"></div>
        </section>
        <section
          id="panel-session"
          class="side-panel-section"
          role="tabpanel"
          aria-labelledby="tab-session"
          hidden
        >
          <div id="session-info" class="side-session-info"></div>
        </section>
      </aside>
    </div>

    <!-- Work Panel -->
    <div id="work-panel-backdrop" class="work-panel-backdrop" hidden></div>
    <section id="work-panel" class="work-panel" aria-hidden="true">
      <div
        id="work-panel-sheet"
        class="work-panel-sheet glass-overlay"
        role="dialog"
        aria-modal="true"
        aria-label="Active work"
        tabindex="-1"
      >
        <button id="work-panel-handle" class="work-panel-handle" type="button" aria-label="Drag work panel">
          <span class="work-panel-grabber"></span>
        </button>
        <div class="work-panel-body">
          <h2 class="work-panel-title">Active Work</h2>
          <div id="work-items" class="work-items"></div>
        </div>
      </div>
    </section>

    <div id="shortcut-overlay" class="shortcut-overlay" hidden>
      <div
        id="shortcut-sheet"
        class="shortcut-sheet glass-overlay"
        role="dialog"
        aria-modal="true"
        aria-labelledby="shortcut-title"
      >
        <div class="shortcut-header">
          <h2 id="shortcut-title" class="shortcut-title">Keyboard shortcuts</h2>
          <button id="shortcut-close" type="button" class="shortcut-close" aria-label="Close keyboard shortcuts">
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
            >
              <path d="M3.5 3.5l9 9M12.5 3.5l-9 9" />
            </svg>
          </button>
        </div>
        <ul class="shortcut-list">
          <li><kbd>/</kbd><span>Focus composer</span></li>
          <li><kbd>Cmd</kbd><kbd>K</kbd><span>Focus composer</span></li>
          <li><kbd>Cmd</kbd><kbd>.</kbd><span>Toggle side panel</span></li>
          <li><kbd>Enter</kbd><span>Send message</span></li>
          <li><kbd>Cmd</kbd><kbd>Enter</kbd><span>Send message</span></li>
          <li><kbd>Esc</kbd><span>Close panel or blur composer</span></li>
          <li><kbd>?</kbd><span>Show shortcut help</span></li>
        </ul>
      </div>
    </div>

    <div id="live-region" class="sr-only-live" aria-live="polite" aria-atomic="true"></div>

    <div id="onboarding-overlay" class="onboarding-overlay" hidden>
      <div class="onboarding-backdrop" aria-hidden="true"></div>
      <section
        id="onboarding-card"
        class="onboarding-card glass-overlay"
        role="dialog"
        aria-modal="true"
        aria-labelledby="onboarding-title"
      >
        <p id="onboarding-step-indicator" class="onboarding-step-indicator">Step 1 of 2</p>
        <form id="onboarding-form" class="onboarding-form">
          <div id="onboarding-step-1" class="onboarding-step" data-onboarding-step="1">
            <h2 id="onboarding-title" class="onboarding-title">What should I call myself?</h2>
            <p class="onboarding-copy">You can change this later.</p>
            <label for="onboarding-owner-name" class="onboarding-label">Your Name</label>
            <input
              id="onboarding-owner-name"
              class="onboarding-input"
              type="text"
              placeholder="Your name"
              minlength="1"
              maxlength="64"
              autocomplete="name"
              required
            />
            <label for="onboarding-agent-name" class="onboarding-label">Agent name</label>
            <input
              id="onboarding-agent-name"
              class="onboarding-input"
              type="text"
              value="Silas"
              minlength="1"
              maxlength="64"
              autocomplete="off"
            />
            <div class="onboarding-actions">
              <button id="onboarding-next-btn" type="button" class="card-cta-primary">Next</button>
            </div>
          </div>

          <div
            id="onboarding-step-2"
            class="onboarding-step hidden"
            data-onboarding-step="2"
            aria-hidden="true"
          >
            <h2 class="onboarding-title">OpenRouter API key</h2>
            <p class="onboarding-copy">Used to validate and enable model access.</p>
            <label for="onboarding-api-key" class="onboarding-label">API key</label>
            <input
              id="onboarding-api-key"
              class="onboarding-input"
              type="password"
              minlength="1"
              autocomplete="off"
            />
            <div class="onboarding-actions">
              <button id="onboarding-back-btn" type="button" class="card-cta-secondary">Back</button>
              <button id="onboarding-finish-btn" type="submit" class="card-cta-primary">Finish</button>
            </div>
          </div>
          <p id="onboarding-error" class="onboarding-error" role="status" aria-live="polite"></p>
        </form>
      </section>
    </div>

    <script src="/app.js?v=3" defer></script>
  </body>
</html>
